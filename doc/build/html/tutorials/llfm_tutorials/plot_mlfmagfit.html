

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MLFM-AG Model Fitting &mdash; pydygp  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="MLFM Simulation" href="plot_mlfmsim.html" />
    <link rel="prev" title="Automatic Relevance Determination" href="plot_ard.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> pydygp
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">PydyGP Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Linear Latent Force Models</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#multiplicative-latent-force-model">Multiplicative Latent Force Model</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#mlfm-adapgrad">MLFM AdapGrad</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html#parameters">Parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../linlatentforcemodels.html">Linear Latent Force Models</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pydygp</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">PydyGP Tutorial</a> &raquo;</li>
        
          <li><a href="index.html">Linear Latent Force Models</a> &raquo;</li>
        
      <li>MLFM-AG Model Fitting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials/llfm_tutorials/plot_mlfmagfit.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-tutorials-llfm-tutorials-plot-mlfmagfit-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="mlfm-ag-model-fitting">
<span id="tutorials-mlfm-fit"></span><span id="sphx-glr-tutorials-llfm-tutorials-plot-mlfmagfit-py"></span><h1>MLFM-AG Model Fitting<a class="headerlink" href="#mlfm-ag-model-fitting" title="Permalink to this headline">¶</a></h1>
<p>This note decribes hot to carry out the porcess of carrying out MAP parameter
estimation for the MLFM model using the Adaptive Gradient matching approximation <a class="reference internal" href="../../generated/pydygp.linlatentforcemodels.MLFMAdapGrad.html#pydygp.linlatentforcemodels.MLFMAdapGrad" title="pydygp.linlatentforcemodels.MLFMAdapGrad"><code class="xref py py-class docutils literal notranslate"><span class="pre">MLFMAdapGrad</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pydygp.linlatentforcemodels</span> <span class="kn">import</span> <span class="n">MLFMAdapGrad</span>
</pre></div>
</div>
<div class="section" id="model-setup">
<h2>Model Setup<a class="headerlink" href="#model-setup" title="Permalink to this headline">¶</a></h2>
<p>We are going to demonstrate using the example we have already described in
<a class="reference internal" href="plot_mlfmsim.html#tutorials-mlfm-sim"><span class="std std-ref">MLFM Simulation</span></a> and the steps described there for setting up
this model and simulating some data. The model was a simple ODE on the unit
circle</p>
<div class="math notranslate nohighlight">
\[S^1 = \{ x \in \mathbb{R}^2 \; : \; \| x \| = 1 \},\]</div>
<p>We can write a linear ode on <span class="math notranslate nohighlight">\(S^1\)</span> as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix} \dot{x}(t) \\ \dot{y}(t) \end{bmatrix}
= \begin{bmatrix} 0 &amp; -1 \\ 1 &amp; 0 \end{bmatrix}
  \begin{bmatrix} x(t) \\ y(t) \end{bmatrix}.\end{split}\]</div>
<p>We can set up this model by and simulate some observations by</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pydygp.liealgebras</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># seed for reproducability</span>

<span class="n">so2</span> <span class="o">=</span> <span class="n">pydygp</span><span class="o">.</span><span class="n">liealgebras</span><span class="o">.</span><span class="n">so</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># import the Lie algebra</span>
<span class="n">mlfm</span> <span class="o">=</span> <span class="n">MLFMAdapGrad</span><span class="p">(</span><span class="n">so2</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># Build the model with 0 offset matrix</span>

<span class="n">tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>    <span class="c1"># time data points</span>
<span class="n">Y</span><span class="p">,</span> <span class="n">gtrue</span> <span class="o">=</span> <span class="n">mlfm</span><span class="o">.</span><span class="n">sim</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tt</span><span class="p">)</span>    <span class="c1"># Simulation result</span>
</pre></div>
</div>
</div>
<div class="section" id="model-fit">
<h2>Model Fit<a class="headerlink" href="#model-fit" title="Permalink to this headline">¶</a></h2>
<p>The API is designed to be as simple as possible and so for reasonably simple
models we should get reasonable results by simply calling</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res0</span> <span class="o">=</span> <span class="n">mlfm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
<p>this returns a simple <code class="xref py py-class docutils literal notranslate"><span class="pre">namedtuple</span></code> object which has attributes with
names corresponding to the parameters described in
<a class="reference internal" href="index.html#tutorials-index-mlfmag-par"><span class="std std-ref">Parameters</span></a>. We can compare the point estimates with
the true latent force functions</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ttdense</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">21</span><span class="p">)</span>  <span class="c1"># make a set of dense times</span>
<span class="n">fig0</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ttdense</span><span class="p">,</span> <span class="n">gtrue</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">ttdense</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">res0</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_mlfmagfit_001.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_mlfmagfit_001.png" />
</div>
<div class="section" id="sample-density-dependenance">
<h2>Sample Density Dependenance<a class="headerlink" href="#sample-density-dependenance" title="Permalink to this headline">¶</a></h2>
<p>The adaptive gradient matching processes depend on the use of GP
interpolators of the unknown state trajectories, and therefore
we might express the accuracy of these methods to decreae not with the
sample size but with the space between samples.</p>
</div>
<div class="section" id="dense-predictions">
<h2>Dense Predictions<a class="headerlink" href="#dense-predictions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mlfm2</span> <span class="o">=</span> <span class="n">MLFMAdapGrad</span><span class="p">(</span><span class="n">so2</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ttdense</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">)</span>
<span class="n">mlfm2</span><span class="o">.</span><span class="n">_setup_times</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">tt_aug</span><span class="o">=</span><span class="n">ttdense</span><span class="p">,</span> <span class="n">data_inds</span><span class="o">=</span><span class="n">data_inds</span><span class="p">)</span>
<span class="n">res_dense</span> <span class="o">=</span> <span class="n">mlfm2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">logpsi_is_fixed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">gtrue</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">ss</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mlfm</span><span class="o">.</span><span class="n">ttc</span><span class="p">,</span> <span class="n">res0</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mlfm2</span><span class="o">.</span><span class="n">ttc</span><span class="p">,</span> <span class="n">res_dense</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_mlfmagfit_002.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_mlfmagfit_002.png" />
<p><strong>Total running time of the script:</strong> ( 0 minutes  5.974 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-llfm-tutorials-plot-mlfmagfit-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_mlfmagfit.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_mlfmagfit.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_mlfmagfit.ipynb" download=""><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_mlfmagfit.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plot_mlfmsim.html" class="btn btn-neutral float-right" title="MLFM Simulation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plot_ard.html" class="btn btn-neutral" title="Automatic Relevance Determination" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Daniel Tait.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>